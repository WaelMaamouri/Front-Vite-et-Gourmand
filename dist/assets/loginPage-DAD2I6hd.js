import{a as u,b as c,r as s}from"./index-Bn2YBzsb.js";function g(){const o=document.getElementById("form-connexion");o&&o.addEventListener("submit",async l=>{var a,i;l.preventDefault();const n=(((a=document.getElementById("email"))==null?void 0:a.value)||"").trim(),r=((i=document.getElementById("password"))==null?void 0:i.value)||"";if(!n||!r){alert("Email et mot de passe obligatoires.");return}const t=o.querySelector('button[type="submit"], input[type="submit"]');t&&(t.disabled=!0);try{const e=await u("/api/login_check",{email:n,password:r});if(!(e!=null&&e.token)||!String(e.token).includes("."))throw new Error("Token JWT invalide re√ßu du serveur.");localStorage.setItem("vg_token",e.token);const m=await c("/api/auth/me");localStorage.setItem("vg_user",JSON.stringify(m)),s(),window.location.href="/menus"}catch(e){console.error(e),localStorage.removeItem("vg_token"),localStorage.removeItem("vg_user"),s(),alert((e==null?void 0:e.message)||"Erreur de connexion.")}finally{t&&(t.disabled=!1)}})}export{g as loadLoginPage};
